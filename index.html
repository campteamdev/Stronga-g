<!DOCTYPE html>
<html lang="pl">
  <head>
    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-W68222TL");
    </script>
    <!-- End Google Tag Manager -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mapa Kempingów</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
    <script src="custom-functions.js"></script>

    <style>
      body {
        margin: 0;
        padding: 0;
      }
      
      /* 🔹 Dynamiczna szerokość popupu */
      .leaflet-popup-content {
          max-width: 80vw;
          word-wrap: break-word;
      }

      /* 🔹 Dostosowanie popupu na telefonach */
      @media (max-width: 600px) {
          .leaflet-popup-content {
              max-width: 90vw;
          }
      }

      #map {
        width: 100%;
        height: 100vh;
      }
    </style>
  </head>
  <body class="" oncontextmenu="return false;">
    <div id="map"></div>

    <script>
      const map = L.map("map").setView([52.392681, 19.275023], 6);
      const markerCluster = L.markerClusterGroup({
        showCoverageOnHover: false,
        maxClusterRadius: 50,
      });

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "&copy; OpenStreetMap contributors",
      }).addTo(map);

      // 🔹 Funkcja dostosowująca szerokość popupu do poziomu zoomu
      function adjustPopupSize() {
          let zoomLevel = map.getZoom(); // Pobiera aktualny zoom
          let popups = document.querySelectorAll(".leaflet-popup-content");

          popups.forEach(popup => {
              if (zoomLevel > 12) {
                  popup.style.maxWidth = "80vw"; // Szeroki popup przy dużym zoomie
              } else if (zoomLevel > 9) {
                  popup.style.maxWidth = "60vw"; // Średni zoom
              } else {
                  popup.style.maxWidth = "40vw"; // Mały popup przy oddaleniu
              }
          });
      }

      // 🔹 Nasłuchiwanie na otwieranie popupów
      map.on("popupopen", function (e) {
          let popupContent = e.popup.getElement(); // Pobiera kontener popupu
          if (!popupContent) return; // Jeśli popupContent nie istnieje, nie rób nic

          adjustPopupSize(); // Ustaw szerokość popupu po otwarciu
      });

      // 🔹 Nasłuchiwanie na zmianę zoomu dla wszystkich otwartych popupów
      map.on("zoomend", adjustPopupSize);
    </script>
  </body>
</html>
